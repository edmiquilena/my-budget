{"version":3,"file":"movements.js","names":["listMovements","req","res","next","limit","query","by","sort","page","filter","includes","JSON","parse","e","console","log","tags","Op","contains","Movement","count","where","creator","user","id","totalRecords","findAll","offset","attributes","order","db","literal","result","status","json","error","message","getMovement","findByPk","params","movement","data","updateMovement","body","concept","amount","date","update","timestamp","removeMovement","destroy","removed","newMovement","type","create","build","save","created"],"sources":["../../src/controllers/movements.js"],"sourcesContent":["import {Movement, db} from '../lib/db'\nimport { Op } from 'sequelize'\n\nexport const listMovements = async (req, res, next) => {\n    const limit = 10;\nlet {by = 'desc', sort = 'timestamp', page = 1, filter = {}} = req.query;\npage = (page < 1) ? 1 : page;\nby = (['asc','desc'].includes(by)) ? by : 'desc'\nsort = (['id','timestamp', 'createdAt'].includes(sort)) ? sort : 'id'\ntry {\nfilter = JSON.parse(filter)\n} catch(e) {\n    filter = {}\n}\nconsole.log(filter?.tags)\nif(filter.tags) {\n    filter.tags =   { [Op.contains]: filter.tags }\n}\nlet totalRecords = await Movement.count({where: {creator: req.user.id, ...filter}})\nlet result = await Movement.findAll({\n    offset:((page-1)*limit),\nlimit : limit,\n    \n    where: {creator: req.user.id,  ...filter},\n    attributes: ['id', 'type', 'concept', 'timestamp', 'amount', 'tags', 'createdAt'],\n    order: db.literal(`${sort} ${by}`)\n})\nif(!result) return res.status(500).json({error: true, message: 'something went wrong'})\n\nreturn res.json({error: false, result, totalRecords, page, filter})\n}\n\n\nexport const getMovement = async(req, res, next) => {\nconst movement = await Movement.findByPk(req.params.id, \n    {attributes: ['id', 'type', 'concept', 'timestamp', 'amount', 'tags', 'createdAt', 'creator']})\nif(!movement || movement.creator !== req.user.id) return res.json({error: true, message: \"No valid record.\"})\nres.json({error: false, data: movement})\n}\n\n\nexport const updateMovement = async(req, res, next) => {\n\nlet {concept, amount, tags, date} = req.body;\nlet update = await Movement.update({concept, amount, tags, timestamp: date}, {where: {id: req.params.id, creator: req.user.id}});\nif(!update) return res.json({error: true, message: \"something went wrong.\"})\nconst movement = await Movement.findByPk(req.params.id, \n    {attributes: ['id', 'type', 'concept', 'timestamp', 'amount', 'tags', 'createdAt', 'creator']})\nif(!movement || movement.creator !== req.user.id) return res.json({error: true, message: \"No valid record.\"})\nres.json({error: false, data: movement})\n}\n\nexport const removeMovement = async(req, res, next) => {\nlet destroy =    await Movement.destroy({where: {id: req.params.id, creator: req.user.id}});\nif(!destroy) return res.json({error:true, removed: false})\nreturn res.json({error:false, removed: true})\n}\nexport const newMovement = async(req, res, next) => {\n    try {\n    let {concept, amount, tags, type, date} = req.body;\n\n\n    let create =  Movement.build({concept, amount, tags, type, creator: req.user.id, timestamp: date })\n    await create.save();\n    return res.json({error:false, created: true, data: create})\n    } catch(e) {\n        console.log(e)\n        res.status(403).json({error: true, message: \"something went wrong.\"})\n    }\n}"],"mappings":"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"}