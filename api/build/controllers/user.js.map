{"version":3,"file":"user.js","names":["register","req","res","next","passport","authenticate","err","user","info","status","send","error","message","undefined","me","session","json","Auth","login","users","User","findOne","where","email","body","attributes","token","jwt","sign","id","process","env","JWT_SECRET","expiresIn"],"sources":["../../src/controllers/user.js"],"sourcesContent":["import 'dotenv/config' \nimport jwt from 'jsonwebtoken';\nimport passport from 'passport';\nimport {User} from '../lib/db'\nexport const register = async (req, res, next) => {\npassport.authenticate('register', async(err, user, info) => {\nif(err)   return res.status(403).send({ error: true, message: 'user cannot be created' }); \n (info !== undefined) ?  res.status(403).send({error: true, message: info.message}) :   res.status(200).send({error: false,  message: 'user created' });\n\n\n\n})\n(req, res, next);\n    \n}\n\n\nexport const me = async (req, res, next) => {\n  passport.authenticate('jwt', { session: false }, (err, user, info) => {\n    if (err)  return res.status(500).json({error: true, message: \"whoops, something went wrong!\"});\n    if (info != undefined || !user) return res.status(403).json({error: true, message: info?.message, Auth: false});\n\n  req.user = user;\n    return res.json({error: false, user, Auth: true});\n    \n  })(req, res, next);\n}\n\nexport const login = async (req, res, next) => {\n\n    passport.authenticate('login', async(err, users, info) => {\n        if (info !== undefined)  return res.status(403).json({error: true, message: info.message});\n         let user =  await User.findOne({\n              where: {\n               email: req.body.email\n              },\n              attributes: ['id', 'email']\n            })\n            if(user) {\n            const token = jwt.sign({ id: user.id }, process.env.JWT_SECRET, {\n                expiresIn: \"7d\",\n              });\n              res.json({\n                error: false,\n                token,\n                user: user\n              });\n            }\n        \n      })(req, res, next);\n  \n \n\n\n}\n"],"mappings":"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"}