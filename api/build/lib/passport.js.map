{"version":3,"file":"passport.js","names":["passport","use","LocalStrategy","usernameField","passwordField","passReqToCallback","session","req","username","password","done","User","findOne","where","email","user","message","create","build","save","validPassword","opts","jwtFromRequest","ExtractJWT","fromAuthHeaderWithScheme","secretOrKey","process","env","JWT_SECRET","JWTstrategy","jwt_payload","id","then","err"],"sources":["../../src/lib/passport.js"],"sourcesContent":["import 'dotenv/config' \nimport passport from 'passport'\nimport { Strategy as LocalStrategy } from 'passport-local';\nimport { Strategy as JWTstrategy, ExtractJwt as ExtractJWT } from 'passport-jwt';\nimport {User} from './db'\n\npassport.use(\n  'register',\n  new LocalStrategy(\n    {\n      usernameField: 'email',\n      passwordField: 'password',\n      passReqToCallback: true,\n      session: false,\n    },\n    async(req, username, password, done) => {\n \n      try {\n       let user = await User.findOne({where: {email: username}})\n          if (user != null) {\n          \n            return done(null, false, { message: 'email already taken'});\n          }\n\n         let create =  User.build({email: username, password})\nawait create.save();\nreturn done(null, create);\n      } catch (err) {\n        return done(err);\n      }\n    },\n  ),\n);\n\npassport.use(\n  'login',\n  new LocalStrategy(\n    {\n      usernameField: 'email',\n      passwordField: 'password',\n      session: false,\n    },\n    async (username, password, done) => {\n      try {\n      let user =   await User.findOne({\n          where: {\n            email: username,\n          }\n        })\n         if (user === null)     return done(null, false, { message: 'Invalid Email/Password.' });\n       \n      if(await  user.validPassword(password)) return done(null, user);\n        \n              return done(null, false, { message: 'Invalid Email/Password.' });\n         \n          \n      } catch (err) {\n         \n        done(err);\n      }\n    },\n  ),\n);\n\nconst opts = {\n  jwtFromRequest: ExtractJWT.fromAuthHeaderWithScheme('JWT'),\n  secretOrKey: process.env.JWT_SECRET,\n};\n\npassport.use(\n  'jwt',\n  new JWTstrategy(opts, (jwt_payload, done) => {\n    try {\n      User.findOne({\n        where: {\n          id: jwt_payload.id,\n        },\n      }).then(user => {\n        if (user) return done(null, user);\n          done(null, false);\n        \n      });\n    } catch (err) {\n      done(err);\n    }\n  }),\n);"],"mappings":"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"}